{"ast":null,"code":"import { KeyCode } from '../constants';\nimport { eventBroker } from './event-broker';\nclass LayerManager {\n  constructor() {\n    this.stack = [];\n    this.handleDocumentKeyDown = event => {\n      var _a, _b, _c;\n      if (event.code === KeyCode.ESCAPE) {\n        const topLayer = this.getTopLayer();\n        if (!topLayer.disableEscapeKeyDown) {\n          (_a = topLayer.onEscapeKeyDown) === null || _a === void 0 ? void 0 : _a.call(topLayer, event);\n          (_b = topLayer.onClose) === null || _b === void 0 ? void 0 : _b.call(topLayer, event, 'escapeKeyDown');\n        }\n      }\n      if (event.code === 'Enter') {\n        const topLayer = this.getTopLayer();\n        (_c = topLayer.onEnterKeyDown) === null || _c === void 0 ? void 0 : _c.call(topLayer, event);\n      }\n    };\n    this.handleDocumentClick = event => {\n      var _a, _b;\n      if (this.isToastClick(event)) {\n        return;\n      }\n      let layer;\n      let mouseDownTarget = null;\n      if (this.mouseDownLayerTarget) {\n        layer = this.mouseDownLayerTarget.layer;\n        mouseDownTarget = this.mouseDownLayerTarget.target;\n        this.mouseDownLayerTarget = undefined;\n        if (!this.stack.includes(layer)) {\n          return;\n        }\n      } else {\n        layer = this.getTopLayer();\n      }\n      if (!layer.disableOutsideClick && this.isOutsideClick(layer, event, mouseDownTarget)) {\n        (_a = layer.onOutsideClick) === null || _a === void 0 ? void 0 : _a.call(layer, event);\n        (_b = layer.onClose) === null || _b === void 0 ? void 0 : _b.call(layer, event, 'outsideClick');\n      }\n    };\n    this.handleDocumentMouseDown = event => {\n      const layer = this.getTopLayer();\n      if (layer) {\n        this.mouseDownLayerTarget = {\n          layer,\n          target: event.target\n        };\n      }\n    };\n  }\n  add(config) {\n    this.stack.push(config);\n    if (this.stack.length === 1) {\n      this.addListeners();\n    }\n    this.notifyLayersChange();\n  }\n  remove(config) {\n    const index = this.stack.indexOf(config);\n    this.stack.splice(index, 1);\n    if (this.stack.length === 0) {\n      this.removeListeners();\n    }\n    this.notifyLayersChange();\n  }\n  getLayersCount() {\n    return this.stack.length;\n  }\n  getLayers() {\n    return this.stack.map(({\n      type\n    }) => ({\n      type\n    }));\n  }\n  addListeners() {\n    document.addEventListener('keydown', this.handleDocumentKeyDown);\n    document.addEventListener('click', this.handleDocumentClick, true);\n    document.addEventListener('mousedown', this.handleDocumentMouseDown, true);\n  }\n  removeListeners() {\n    document.removeEventListener('keydown', this.handleDocumentKeyDown);\n    document.removeEventListener('click', this.handleDocumentClick, true);\n    document.removeEventListener('mousedown', this.handleDocumentMouseDown, true);\n  }\n  notifyLayersChange() {\n    eventBroker.publish({\n      componentId: 'LayerManager',\n      eventId: 'layerschange',\n      meta: {\n        /**\n         * @deprecated use layers\n         */\n        layersCount: this.getLayersCount(),\n        layers: this.getLayers()\n      }\n    });\n  }\n  getTopLayer() {\n    return this.stack[this.stack.length - 1];\n  }\n  isOutsideClick(layer, event, mouseDownTarget = null) {\n    const contentElements = layer.contentRefs || [];\n    const {\n      target\n    } = event;\n    const composedPath = typeof event.composedPath === 'function' ? event.composedPath() : [];\n    if (contentElements.length > 0) {\n      const isClickOnContentElements = contentElements.some(el => {\n        var _a, _b, _c, _d;\n        return ((_b = (_a = el === null || el === void 0 ? void 0 : el.current) === null || _a === void 0 ? void 0 : _a.contains) === null || _b === void 0 ? void 0 : _b.call(_a, target)) || ((_d = (_c = el === null || el === void 0 ? void 0 : el.current) === null || _c === void 0 ? void 0 : _c.contains) === null || _d === void 0 ? void 0 : _d.call(_c, mouseDownTarget)) || composedPath.includes(el === null || el === void 0 ? void 0 : el.current);\n      });\n      return !isClickOnContentElements;\n    }\n    return false;\n  }\n  isToastClick(event) {\n    const composedPath = typeof event.composedPath === 'function' ? event.composedPath() : [];\n    return composedPath.some(el => {\n      var _a;\n      return Boolean((_a = el === null || el === void 0 ? void 0 : el.dataset) === null || _a === void 0 ? void 0 : _a.toast);\n    });\n  }\n}\nexport const layerManager = new LayerManager();\nexport const getLayersCount = () => {\n  return layerManager.getLayersCount();\n};","map":{"version":3,"names":["KeyCode","eventBroker","LayerManager","constructor","stack","handleDocumentKeyDown","event","_a","_b","_c","code","ESCAPE","topLayer","getTopLayer","disableEscapeKeyDown","onEscapeKeyDown","call","onClose","onEnterKeyDown","handleDocumentClick","isToastClick","layer","mouseDownTarget","mouseDownLayerTarget","target","undefined","includes","disableOutsideClick","isOutsideClick","onOutsideClick","handleDocumentMouseDown","add","config","push","length","addListeners","notifyLayersChange","remove","index","indexOf","splice","removeListeners","getLayersCount","getLayers","map","type","document","addEventListener","removeEventListener","publish","componentId","eventId","meta","layersCount","layers","contentElements","contentRefs","composedPath","isClickOnContentElements","some","el","_d","current","contains","Boolean","dataset","toast","layerManager"],"sources":["/Users/ilaulanov/node_modules/@gravity-ui/uikit/build/esm/components/utils/LayerManager.js"],"sourcesContent":["import { KeyCode } from '../constants';\nimport { eventBroker } from './event-broker';\nclass LayerManager {\n    constructor() {\n        this.stack = [];\n        this.handleDocumentKeyDown = (event) => {\n            var _a, _b, _c;\n            if (event.code === KeyCode.ESCAPE) {\n                const topLayer = this.getTopLayer();\n                if (!topLayer.disableEscapeKeyDown) {\n                    (_a = topLayer.onEscapeKeyDown) === null || _a === void 0 ? void 0 : _a.call(topLayer, event);\n                    (_b = topLayer.onClose) === null || _b === void 0 ? void 0 : _b.call(topLayer, event, 'escapeKeyDown');\n                }\n            }\n            if (event.code === 'Enter') {\n                const topLayer = this.getTopLayer();\n                (_c = topLayer.onEnterKeyDown) === null || _c === void 0 ? void 0 : _c.call(topLayer, event);\n            }\n        };\n        this.handleDocumentClick = (event) => {\n            var _a, _b;\n            if (this.isToastClick(event)) {\n                return;\n            }\n            let layer;\n            let mouseDownTarget = null;\n            if (this.mouseDownLayerTarget) {\n                layer = this.mouseDownLayerTarget.layer;\n                mouseDownTarget = this.mouseDownLayerTarget.target;\n                this.mouseDownLayerTarget = undefined;\n                if (!this.stack.includes(layer)) {\n                    return;\n                }\n            }\n            else {\n                layer = this.getTopLayer();\n            }\n            if (!layer.disableOutsideClick && this.isOutsideClick(layer, event, mouseDownTarget)) {\n                (_a = layer.onOutsideClick) === null || _a === void 0 ? void 0 : _a.call(layer, event);\n                (_b = layer.onClose) === null || _b === void 0 ? void 0 : _b.call(layer, event, 'outsideClick');\n            }\n        };\n        this.handleDocumentMouseDown = (event) => {\n            const layer = this.getTopLayer();\n            if (layer) {\n                this.mouseDownLayerTarget = { layer, target: event.target };\n            }\n        };\n    }\n    add(config) {\n        this.stack.push(config);\n        if (this.stack.length === 1) {\n            this.addListeners();\n        }\n        this.notifyLayersChange();\n    }\n    remove(config) {\n        const index = this.stack.indexOf(config);\n        this.stack.splice(index, 1);\n        if (this.stack.length === 0) {\n            this.removeListeners();\n        }\n        this.notifyLayersChange();\n    }\n    getLayersCount() {\n        return this.stack.length;\n    }\n    getLayers() {\n        return this.stack.map(({ type }) => ({ type }));\n    }\n    addListeners() {\n        document.addEventListener('keydown', this.handleDocumentKeyDown);\n        document.addEventListener('click', this.handleDocumentClick, true);\n        document.addEventListener('mousedown', this.handleDocumentMouseDown, true);\n    }\n    removeListeners() {\n        document.removeEventListener('keydown', this.handleDocumentKeyDown);\n        document.removeEventListener('click', this.handleDocumentClick, true);\n        document.removeEventListener('mousedown', this.handleDocumentMouseDown, true);\n    }\n    notifyLayersChange() {\n        eventBroker.publish({\n            componentId: 'LayerManager',\n            eventId: 'layerschange',\n            meta: {\n                /**\n                 * @deprecated use layers\n                 */\n                layersCount: this.getLayersCount(),\n                layers: this.getLayers(),\n            },\n        });\n    }\n    getTopLayer() {\n        return this.stack[this.stack.length - 1];\n    }\n    isOutsideClick(layer, event, mouseDownTarget = null) {\n        const contentElements = layer.contentRefs || [];\n        const { target } = event;\n        const composedPath = typeof event.composedPath === 'function' ? event.composedPath() : [];\n        if (contentElements.length > 0) {\n            const isClickOnContentElements = contentElements.some((el) => {\n                var _a, _b, _c, _d;\n                return ((_b = (_a = el === null || el === void 0 ? void 0 : el.current) === null || _a === void 0 ? void 0 : _a.contains) === null || _b === void 0 ? void 0 : _b.call(_a, target)) ||\n                    ((_d = (_c = el === null || el === void 0 ? void 0 : el.current) === null || _c === void 0 ? void 0 : _c.contains) === null || _d === void 0 ? void 0 : _d.call(_c, mouseDownTarget)) ||\n                    composedPath.includes(el === null || el === void 0 ? void 0 : el.current);\n            });\n            return !isClickOnContentElements;\n        }\n        return false;\n    }\n    isToastClick(event) {\n        const composedPath = typeof event.composedPath === 'function' ? event.composedPath() : [];\n        return composedPath.some((el) => {\n            var _a;\n            return Boolean((_a = el === null || el === void 0 ? void 0 : el.dataset) === null || _a === void 0 ? void 0 : _a.toast);\n        });\n    }\n}\nexport const layerManager = new LayerManager();\nexport const getLayersCount = () => {\n    return layerManager.getLayersCount();\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}